---
layout: post
title: 2022-01-04-UsingDB
#image:
#  path: /assets/img/code/r/usingDB/7.png
description: >
  R, Oracle, Database
sitemap: false
hide_last_modified: true
invert_sidebar: false
categories:
  - code
  - r
---


# R studio 에서 DB 접근하기

본 글은 R 3.6.3ver / Oracle DB 11g / java8 에서 작성되었습니다.

##### 1. Dos에서 SQLPLUS 명령어로 로그인을하고 다음과 같이 테이블을 생성해줍니다.
﻿![1](/assets/img/code/r/usingDB/3.png)
> SQL테이블 생성할 때 줄바꿈시 생기는 2, 3, 4, 5, ... 는 줄번호를 의미합니다.

```code
cd\ #최상위 디렉토리로 이동

sqlplus
#DB 아이디 및 패스워드 입력

CREATE TABLE TEST_TABLE(
  ID VARCHAR(50) PRIMARY KEY,
  PASS VARCHAR(30) NOT NULL,
  NAME VARCHAR(25) NOT NULL,
  AGE NUMBER(2)
);
```
<br><br>

##### 2. ﻿생성된 테이블에 행을 추가해 보겠습니다.
![2](/assets/img/code/r/usingDB/4.png)
```code
INSERT INTO TEST_TABLE VALUES('hong','1234','홍길동',35);
INSERT INTO TEST_TABLE VALUES('kim','5678','김길동',45);
```
﻿다음과 같이 홍길동과 김길동 행이 추가 되었습니다.
<br><br><br>

##### 3. ﻿﻿추가한 행을 선택하고 커밋하여 마무리합니다.
![3](/assets/img/code/r/usingDB/5.png)
```code
COMMIT;
```
<br><br><br>

##### 4. ﻿드라이버 설정을 위해 c 드라이브에 임시로 OracleTest 폴더를 만들어줍니다.
![4](/assets/img/code/r/usingDB/1.png)
<br><br><br>

##### 5. 새로 만든 폴더에 ojdbc6 프로그램을 넣어줍니다.
![5](/assets/img/code/r/usingDB/2.png)
>보통 오라클이 설치된 다음의 경로(C:\oraclexe\app\oracle\product\11.2.0\server\jdbc\lib)에
ojdbc6 이라는 프로그램이 있습니다.

<br><br><br>

##### 6. ﻿R로 돌아와서 아래와 같이 패키지를 설치해줍니다.
```R
# 환경설정
rm(list=ls())
Sys.setenv(JAVA_HOME = "C:/Program Files/Java/jdk1.8.0_311/bin")
drv <- JDBC("oracle.jdbc.driver.OracleDriver", "C:/OracleTest/ojdbc6.jar")
conn <- dbConnect(drv,"jdbc:oracle:thin:@//127.0.0.1:1521/xe", "scott", "lion")

# 라이브러리
remove.packages("rJava", lib="~/R/win-library/4.0")
install.packages("DBI")
library(DBI)
install.packages("RJDBC")
library(RJDBC)
install.packages("rJava")
library(rJava)
```
>﻿환경설정에서
Sys.setenv 부분은 자바를 설치하실 때 환경변수로 지정했던걸 입력하고
dbConnect 부분은 scott과 tiger 부분에 각각 db 계정과 비번을 입력해주시면 되겠습니다.

이제 패키지 3개를 설치 하셨으면 DB와 연결되었는지 확인해보겠습니다.
<br><br><br>

﻿##### 7. R Studio에서 DB 다루기
* ﻿dbGetQuery()함수
```R
> query = "SELECT * FROM test_table"
> dbGetQuery(conn,query)
    ID PASS   NAME AGE
1 hong 1234 홍길동  35
2  kim 5678 김길동  45
```
>﻿dbGetQuery()함수를 사용하면 모든 레코드를 살펴볼 수 있습니다.

<br>

* 나이 기준으로 내림차순 정렬
```R
> query = "SELECT * FROM test_table order by age desc"
> dbGetQuery(conn, query)
    ID PASS   NAME AGE
1  kim 5678 김길동  45
2 hong 1234 홍길동  35
```
<br>

* 레코드 추가
```R
> query = "insert into test_table values('kang', '1234', '강감찬', 45)"
> dbSendUpdate(conn, query)

> # 추가확인
> query = "SELECT * FROM test_table"
> dbGetQuery(conn, query)
    ID PASS   NAME AGE
1 hong 1234 홍길동  35
2  kim 5678 김길동  45
3 kang 1234 강감찬  45
```
<br>

* ﻿나이가 40세 이상인 record 추출
```R
> query = "select * from test_table where age >= 40"
> result <- dbGetQuery(conn, query)
> result
    ID PASS   NAME AGE
1  kim 5678 김길동  45
2 kang 1234 강감찬  45
```
<br><br><br>

##### 8. SQL Developer에서 작업내역 확인
![6](/assets/img/code/r/usingDB/6.png)
** 생성된 테이블과 추가된 컬럼

<br><br><br>

##### 9. 데이터 내용
![7](/assets/img/code/r/usingDB/7.png)
** 추가한 행데이터

<b>이상으로 R studio에서 Oracle database 다루기를 마칩니다👏<b>
